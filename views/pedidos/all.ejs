<% layout('layouts/boilerplate')%>
    <div class="row">
        <div class="col-lg-4">
            <!-- <div class=" d-lg-none">
                <a href="pedidos/novo" class="btn btn-primary d-block">Novo Pedido</a>
            </div> -->
            <form action="/pedidos" method="GET" class="m-3 ">
                <label for="data">Data:</label>
                <input type="date" name="data" id="data" value="<%=data%>">
                <button class="btn btn-primary ">Filtrar</button>
            </form>
            <table class="table table-sm mb-3">
                <thead>
                    <tr>
                        <th colspan="100%">
                            Totais por produto
                        </th>
                    </tr>
                    <tr>
                        <th>Produto</th>
                        <th>Qty</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <% for(let i in pedidosIndex){ %>
                        <tr>
                            <td>
                                <%=i%>
                            </td>
                            <td>
                                <%=pedidosIndex[i].qty %>
                            </td>
                            <td>
                                R$<%=pedidosIndex[i].valor %>
                            </td>

                        </tr>
                        <% } %>
                </tbody>
            </table>
            <script>
                let pedidos = <%- JSON.stringify(pedidos) %>
            </script>
            <table class="table table-sm  mb-3">
                <thead>
                    <th colspan="100%">
                        Totais por pagamento
                    </th>
                </thead>
                <tbody>

                    <tr>
                        <th>Dinheiro</th>
                        <td>R$<%=pedidos.filter(x=> x.pagamento.metodo == "dinheiro").map(x=>
                                x.pagamento.total).reduce((total,n)=> total+n,0)%></td>
                    </tr>
                    <tr>
                        <th>Cartão</th>
                        <td>R$<%=pedidos.filter(x=> x.pagamento.metodo == "cartão").map(x=>
                                x.pagamento.total).reduce((total,n)=> total+n,0)%></td>
                    </tr>
                    <tr>
                        <th>Pix</th>
                        <td>R$<%=pedidos.filter(x=> x.pagamento.metodo == "pix").map(x=>
                                x.pagamento.total).reduce((total,n)=> total+n,0)%> </td>
                    </tr>
                    <tr>
                        <th>Total Entregas</th>
                        <td>R$<%=pedidos.map(i=> i.cliente.frete).reduce( (total,num) => total+num,0)%></td>
                    </tr>
                    <tr>
                        <th>Total</th>
                        <td>R$<%=pedidos.map(i=> i.pagamento.total).reduce( (total,num) => total+num,0)%></td>
                    </tr>
                </tbody>

            </table>

        </div>
        <div class="col-lg-8 ">



            <table class="table table-sm table-responsive table-hover ">

                <thead class="table-dark">
                    <tr>
                        <th>#N°</th>
                        <th>Hora</th>
                        <!-- <th>Status</th> -->
                        <th>Nome</th>
                        <th class="d-none d-lg-block">Telefone</th>
                        <th>Entrega</th>
                        <th class="d-none d-lg-block">Pagamento</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <% if(pedidos.length){ %>
                    <tbody class="pedidos">
                        <% for(let pedido of pedidos){%>
                            <tr data-url="/pedidos/<%=pedido._id%>">
                                <td>
                                    <span class="badge rounded-pill bg-primary">
                                        #<%=pedido.numero%>
                                    </span>

                                </td>
                                <td>
                                    <%=helper.formatHour(pedido.data)%>
                                </td>
                                <!-- <td>
                                pedido.status
                            </td> -->
                                <td>
                                    <%=pedido.cliente.nome%>
                                </td>
                                <td class="d-none d-lg-block">
                                    <%if(pedido.entrega=="delivery"){%>
                                        <a
                                            href="whatsapp://send?phone=55<%=pedido.cliente.telefone%>&text=Oi+<%=pedido.cliente.nome%>">
                                            <%=pedido.cliente.telefone%>
                                        </a>
                                        <%}else{%>
                                            <span>-</span>
                                            <%}%>

                                </td>
                                <td class="<%=pedido.entrega%>">
                                    <%=pedido.entrega%>
                                </td>
                                <td class="<%=pedido.pagamento.metodo%> d-none d-lg-block">
                                    <%=pedido.pagamento.metodo%>
                                </td>
                                <td>
                                    R$<%=pedido.pagamento.total%>
                                </td>

                            </tr>
                            <%}%>
                    </tbody>
                    <% }else{ %>
                        <tbody>
                            <tr>
                                <td colspan="100%"><span class="lead text-center">Nada para ver aqui...</span></td>
                            </tr>
                            <% } %>
                        </tbody>
            </table>

        </div>
    </div>
    <link rel="stylesheet" href="/styles/metodos.css">
    <%- include('../partials/tables')%>